{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/proyectos/nopain/utils/supabase/middleware.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { type NextRequest, type NextResponse } from \"next/server\"\n\nexport function createClient(req: NextRequest, res: NextResponse) {\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          return req.cookies.get(name)?.value\n        },\n        set(name: string, value: string, options: any) {\n          try {\n            res.cookies.set({\n              name,\n              value,\n              ...options,\n            })\n          } catch {\n            // En entornos Edge, puede no ser compatible, por eso hacemos un fallback\n          }\n        },\n        remove(name: string, options: any) {\n          try {\n            res.cookies.set({\n              name,\n              value: \"\",\n              ...options,\n            })\n          } catch {}\n        },\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAGO,SAAS,aAAa,GAAgB,EAAE,GAAiB;IAC9D,OAAO,IAAA,8NAAkB,sUAGvB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAY;gBAC3C,IAAI;oBACF,IAAI,OAAO,CAAC,GAAG,CAAC;wBACd;wBACA;wBACA,GAAG,OAAO;oBACZ;gBACF,EAAE,OAAM;gBACN,yEAAyE;gBAC3E;YACF;YACA,QAAO,IAAY,EAAE,OAAY;gBAC/B,IAAI;oBACF,IAAI,OAAO,CAAC,GAAG,CAAC;wBACd;wBACA,OAAO;wBACP,GAAG,OAAO;oBACZ;gBACF,EAAE,OAAM,CAAC;YACX;QACF;IACF;AAEJ"}},
    {"offset": {"line": 56, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/proyectos/nopain/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport type { NextRequest } from \"next/server\"\nimport { createClient } from \"@/utils/supabase/middleware\"\n\nexport async function middleware(req: NextRequest) {\n  const res = NextResponse.next()\n  const supabase = createClient(req, res)\n\n  // Obtener usuario actual\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  const pathname = req.nextUrl.pathname\n\n  // âœ… Rutas protegidas (solo con sesiÃ³n)\n  const protectedRoutes = [\"/clinics\", \"/clinic-panel\"]\n\n  // Si no hay sesiÃ³n y quiere acceder a una ruta protegida â†’ redirigir a login\n  if (!user && protectedRoutes.some((path) => pathname.startsWith(path))) {\n    const redirectUrl = req.nextUrl.clone()\n    redirectUrl.pathname = \"/login\"\n    return NextResponse.redirect(redirectUrl)\n  }\n\n  // Si hay sesiÃ³n, obtener rol del usuario\n  if (user) {\n    const { data: profile } = await supabase\n      .from(\"profiles\")\n      .select(\"role\")\n      .eq(\"id\", user.id)\n      .single()\n\n    const role = profile?.role || \"paciente\"\n\n    // ðŸš« Bloquear acceso de pacientes al panel de clÃ­nicas\n    if (pathname.startsWith(\"/clinic-panel\") && role !== \"clinica\") {\n      const redirectUrl = req.nextUrl.clone()\n      redirectUrl.pathname = \"/clinics\"\n      return NextResponse.redirect(redirectUrl)\n    }\n\n    // ðŸš« (Opcional) Bloquear acceso de clÃ­nicas al Ã¡rea pÃºblica si lo prefieres\n    // if (pathname.startsWith(\"/clinics\") && role === \"clinica\") {\n    //   const redirectUrl = req.nextUrl.clone()\n    //   redirectUrl.pathname = \"/clinic-panel\"\n    //   return NextResponse.redirect(redirectUrl)\n    // }\n  }\n\n  return res\n}\n\n// Indica a Next.js en quÃ© rutas debe ejecutarse el middleware\nexport const config = {\n  matcher: [\"/clinics/:path*\", \"/clinic-panel/:path*\"],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEO,eAAe,WAAW,GAAgB;IAC/C,MAAM,MAAM,uNAAY,CAAC,IAAI;IAC7B,MAAM,WAAW,IAAA,8KAAY,EAAC,KAAK;IAEnC,yBAAyB;IACzB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,MAAM,WAAW,IAAI,OAAO,CAAC,QAAQ;IAErC,uCAAuC;IACvC,MAAM,kBAAkB;QAAC;QAAY;KAAgB;IAErD,6EAA6E;IAC7E,IAAI,CAAC,QAAQ,gBAAgB,IAAI,CAAC,CAAC,OAAS,SAAS,UAAU,CAAC,QAAQ;QACtE,MAAM,cAAc,IAAI,OAAO,CAAC,KAAK;QACrC,YAAY,QAAQ,GAAG;QACvB,OAAO,uNAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,yCAAyC;IACzC,IAAI,MAAM;QACR,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,MAAM,OAAO,SAAS,QAAQ;QAE9B,uDAAuD;QACvD,IAAI,SAAS,UAAU,CAAC,oBAAoB,SAAS,WAAW;YAC9D,MAAM,cAAc,IAAI,OAAO,CAAC,KAAK;YACrC,YAAY,QAAQ,GAAG;YACvB,OAAO,uNAAY,CAAC,QAAQ,CAAC;QAC/B;IAEA,4EAA4E;IAC5E,+DAA+D;IAC/D,4CAA4C;IAC5C,2CAA2C;IAC3C,8CAA8C;IAC9C,IAAI;IACN;IAEA,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAmB;KAAuB;AACtD"}}]
}